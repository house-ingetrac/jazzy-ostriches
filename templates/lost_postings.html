{% extends "base.html" %}

{% block head %}
<script src="https://maps.googleapis.com/maps/api/js?key={{api_key}}"></script>
<script>
var infowindow = new google.maps.InfoWindow();
var listings = "{{listings}}".slice(1, -1);
//listings = JSON.parse("[" + listings + "]");

// example dictionary
// [{'item_id': 1, 'item_name': u'crossbow', 'item_desc': u'a family heirloom, my grandpa used to be a werewolf hunter, idk', 'item_lat': 0.0, 'item_long': 0.0}, {'item_id': 2, 'item_name': u'my purpose of existence', 'item_desc': u'I had it before and it was great, but I dropped it somewhere in stuy', 'item_lat': 0.0, 'item_long': 0.0}, {'item_id': 3, 'item_name': u'dog', 'item_desc': u'where is it', 'item_lat': 40.7589, 'item_long': 73.985}, {'item_id': 4, 'item_name': u'dog', 'item_desc': u'where is it', 'item_lat': 40.7589, 'item_long': 73.985}, {'item_id': 5, 'item_name': u'doorknob', 'item_desc': u'brass', 'item_lat': 44.23, 'item_long': 80.434}, {'item_id': 6, 'item_name': u'protein shake', 'item_desc': u'i need my protein to get lean', 'item_lat': 22.43, 'item_long': 95.3578}, {'item_id': 7, 'item_name': u'almond milk', 'item_desc': u'its not milk, tastes nutty', 'item_lat': 65.345, 'item_long': 43.8745}, {'item_id': 8, 'item_name': u'umbrella', 'item_desc': u'pink and super cute, wooden handle', 'item_lat': 22.876, 'item_long': 65.3422}]

// finds number of Markers
var all_locations = [];
for (var listing in listings){
 all_locations.push([listing['item_lat'], listing['item_long']]);
};
var markers = [... new Set(all_locations)] //filter to find all unique all_locations
// JSON.stringify(markers);
// console.log(markers);

//helper function: adds postings to each marker on click
// function add_postings(marker, i, items_list) {
//   var contentString = "";
//   //adds first 5 posts
//   for(i = 0; i < 5; i++){
//     try{
//       contentString += "<form action='/posting'><input type='hidden' name='item_id' value='"+items_list[2]+"'><input type='submit' value='"+items_list[1] + "'></form>";
//     };
//     catch(e){
//       break;
//     };
//   };
//   //adds See More button
//   contentString += "<br>" + "<form action='/listings'><input type='submit' value='See More'><input type='hidden' name='location' value='"+items_list[0]+"'></form>";
//   infowindow.setContent(contentString);
//   infowindow.open(map, marker);
// };

function initialize() {
  var map = new google.maps.Map(document.getElementById('sidemap'), {
    zoom: 13,
    center: new google.maps.LatLng(40.76, -73.99), //center for times square
    mapTypeId: google.maps.MapTypeId.ROADMAP
  });
  var marker = new google.maps.Marker({
       position: new google.maps.LatLng(40.76, -73.99),
       label: "15",
       map: map
  });
};

//add markers to map
// for(loc = 0; loc < markers.length; loc++){
//   //creates new array of items at location
//   var items = [];
//   for each (listing in listings){
//     if (markers[loc] == listing[0]){
//       items.push(listing)
//     };
//   };
//
//   var marker = new google.maps.Marker({
//     position: new google.maps.LatLng(markers[loc][0], markers[loc][1]),
//     label: items.length.toString(),
//     map: map
//   });
//   google.maps.event.addListener(marker, 'click', add_postings(marker, i, items));
// };
google.maps.event.addDomListener(window, 'load', initialize);
</script>
{% endblock %}

{% block content %}
<div class="filter">
  <form action="/lost_postings" method="POST">
    <div id="search-wrapper">
      <input type="text" placeholder="  Search" name="search" id="search-input">
      <button type="button" id="search-btn" name="submit-search" value="searched">
        <span class="glyphicon glyphicon-search"></span>
      </button>
    </div>
    <div id="white-block"></div>
    <select class="filterdrop" name="borough">
      <option value="none">Borough</option>
      <option value="manhattan">Mahattan</option>
      <option value="brooklyn">Brooklyn</option>
      <option value="queens">Queens</option>
      <option value="staten">Staten Island</option>
    </select>
    <select class="filterdrop" name="category">
      <option value="none">Category</option>
      <option value="bags">Bags</option>
      <option value="wallets">Wallets</option>
      <option value="documents">Documents</option>
      <option value="accessories">Accessories</option>
      <option value="electronics">Electronics</option>
      <option value="other">Other</option>
    </select>
    <select class="filterdrop" name="date">
      <option value="none">Sort</option>
      <option value="newest">Newest</option>
      <option value="oldest">Oldest</option>
    </select>
    <input id="filterbtn" type="submit" name="filter" value="Filter">
  </form>
</div>
<div id="overflow">
    <div class="postings">
      <h1 style="padding-left:17px;"> Lost Items</h1>
      {% for item in listings %}
        <div id="post-container">
          <h3>{{item['item_name']}}</h3><br>
          Category: {{item[1]}}<br>
          Date: {{item[2]}}<br>
          Location: {{item['item_lat']}} , {{item['item_long']}}<br><br>
          <form action="/single_posting" method="POST">
            <input type="submit" class="btn" style="float:right;" name="single_post" value="See More">
            <input type="hidden" name="item-id" value="{{item['item_id']}}">
          </form>
        </div>
      {% endfor %}
    </div>
  <div id="sidemap"></div>
</div>
{% endblock %}
